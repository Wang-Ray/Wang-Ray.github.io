---
layout: post
title: 实践Dubbo之SPI
categories: Java
tags: Java SPI Dubbo
---

## 特性

### 自动包装

如果Extension实现的构造函数入参是Extension，则其称为Extension包装（Extension Wrapper）

### 自动加载

支持setter注入其他Extension或Spring容器中的Bean

### 自适应

根据参数适配Extension实现

### 自动激活

默认是按需激活，也可以自动激活

## @SPI

## @Adaptive

## @Activate







## ExtensionLoader

创建Extension实例

### getExtension

### getAdaptiveExtension

### getActivateExtension



## ExtensionFactory

Extension依赖注入辅助，可能是依赖其他Extension（SpiExtensionFactory），或者依赖Spring Bean（SpringExtensionFactory）。默认实现AdaptiveExtensionFactory（有@Adaptive注解），由其聚合统筹



## 实现



```java
// ExtensionLoader缓存
org.apache.dubbo.common.extension.ExtensionLoader#EXTENSION_LOADERS

// Extension实例缓存
org.apache.dubbo.common.extension.ExtensionLoader#EXTENSION_INSTANCES

org.apache.dubbo.common.extension.ExtensionLoader#cachedDefaultName

// Extension实例缓存
org.apache.dubbo.common.extension.ExtensionLoader#cachedInstances

org.apache.dubbo.common.extension.ExtensionLoader#cachedAdaptiveInstance

org.apache.dubbo.common.extension.ExtensionLoader#objectFactory

org.apache.dubbo.common.extension.ExtensionLoader#cachedNames

// Extension类缓存
org.apache.dubbo.common.extension.ExtensionLoader#cachedClasses
// Extension包装类缓存
org.apache.dubbo.common.extension.ExtensionLoader#cachedWrapperClasses
// Extension Adaptive类缓存
org.apache.dubbo.common.extension.ExtensionLoader#cachedAdaptiveClass
```





## 参考

[Dubbo 扩展点加载机制：从 Java SPI 到 Dubbo SPI](https://juejin.im/post/5e7834cc51882549087dc7ef)