---
layout: post
title: "实践Jenkins"
date: 2019-04-17 11:08:00 +0800
categories: DevOps
tags: DevOps Jenkins
---

[Jenkins](https://jenkins.io/)

## 安装和配置Jenkins

### 安装Jenkins

操作系统：CentOS 7.6 64位

Jenkins：2.176.1

```shell
# 安装java
$ sudo yum install java
# 安装jenkins
$ sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo
$ sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key
$ sudo yum install jenkins

$ sudo chkconfig jenkins on

# 启动jenkins
$ sudo service jenkins start
# 或者
$ sudo systemctl start jenkins
```

默认会新建jenkins用户，此用户只是jenkins的运行用户，不能登陆。

默认jenkins工作目录在`/var/lib/jenkins`

### 安装JDK

### 安装Maven

默认`.m2`目录在jenkins工作目录下

### 安装Git

```shell
$ sudo yum -y install git
```

### 升级Jenkins

```shell
$ sudo yum update jenkins
```



## 最佳实践

从远程仓库获取的项目源码存放在jenkins工作目录下面的`workspace/{projectname}/`

每次构件后jenkins会把构建结果归档到jenkins工作目录下的`jobs/{projectname}/modules/{groupId}${artifactId}/builds/{buildtimes}/archive/`

## plugin

### [Publish Over SSH](https://plugins.jenkins.io/publish-over-ssh)

#### 系统配置

备注：配置好ssh免密登陆。

![publish-over-ssh](/images/publish-over-ssh.png)

#### 任务配置

![over-ssh](/images/over-ssh.png)

Remove prefix：设定Source files的部分目录结构不用在远程服务器创建

Flatten files：Source files的目录结构不在远程服务器创建

Exec command：执行的shell命令，后一行的命令不依赖前一行命令的执行结果，如果需要，可以使用`&&`

#### 参数化部署

![parameterized publishing](/images/parameterized-publishing-1.png)

![parameterized publishing](/images/parameterized-publishing-2.png)

![parameterized publishing](/images/parameterized-publishing-3.png)

### [Build With Parameters](https://wiki.jenkins-ci.org/display/JENKINS/Build+With+Parameters+Plugin)

### [Persistent Parameter Plugin](http://wiki.jenkins-ci.org/display/JENKINS/Persistent+Parameter+Plugin)

### Git Parameter

![git parameter](/images/git-parameter-1.png)

![git parameter](/images/git-parameter-2.png)

## 参考资料

《Jenkins 2.x实践指南》，[翟志军](http://showme.codes)